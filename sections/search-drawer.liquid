{{ 'section-search-drawer.css' | asset_url | stylesheet_tag }}

{% assign popular_searches = '' %}
{% assign popular_searches = popular_searches | append: section.settings.popular_search_1 | append: '|' %}
{% assign popular_searches = popular_searches | append: section.settings.popular_search_2 | append: '|' %}
{% assign popular_searches = popular_searches | append: section.settings.popular_search_3 | append: '|' %}
{% assign popular_searches = popular_searches | append: section.settings.popular_search_4 %}
{% assign popular_searches_array = popular_searches | split: '|' %}

{% assign has_popular_searches = false %}
{% for search_term in popular_searches_array %}
  {% unless search_term == blank %}
    {% assign has_popular_searches = true %}
    {% break %}
  {% endunless %}
{% endfor %}

<aside
  id="searchDrawer"
  class="search-drawer"
  role="dialog"
  aria-labelledby="search-title"
>
  <div class="search-drawer__container custom-scrollbar">
    <header class="search-drawer__header">
      <h2 id="search-title" class="search-drawer__title heading--xl">Search</h2>
      <button
        class="search-drawer__close"
        type="button"
        aria-label="Close search"
      >
        {% render '_icon-close' %}
      </button>
    </header>

    <div class="search-drawer__content">
      {% render 'search-form' %}

      <div class="search-content-wrapper">
        <div
          id="searchLoading"
          class="search-drawer__loading small search-state-transition hidden"
        >
          <div class="animated-loader">
            <svg fill="#E7E7E7" style="height:4px;display:block" viewBox="0 0 40 4" xmlns="http://www.w3.org/2000/svg">
              <style>
                .react{animation:moving 1s ease-in-out infinite}
                @keyframes moving{0%{width:0}50%{width:100%;transform:translate(0,0)}100%{width:0;right:0;transform:translate(100%,0)}}
              </style>
              <rect class="react" fill="#E7E7E7" height="4" width="40" />
            </svg>
          </div>
        </div>

        <div
          id="noResultsContainer"
          class="predictive-search__no-results small search-state-transition hidden"
        >
          <button
            type="button"
            id="noResultsSearchButton"
            class="predictive-search__search-button button body"
            style="margin-top: 0;"
          ></button>
        </div>

        <div
          id="searchResultsContainer"
          class="search-state-transition hidden"
        >
          <div id="productResults" style="display: none;">
            <h3 class="predictive-search__title heading--l">Products</h3>
            <ul id="productResultsList" class="predictive-search__results"></ul>
          </div>

          <div id="collectionResults" style="display: none;">
            <h3 class="predictive-search__title heading--l">Collections</h3>
            <ul id="collectionResultsList" class="predictive-search__results"></ul>
          </div>

          <button
            type="button"
            id="searchResultsButton"
            class="predictive-search__search-button button body"
            style="display: none;"
          ></button>
        </div>

        {% if has_popular_searches %}
          <div
            id="popularSearches"
            class="popular-searches search-state-transition"
          >
            <h3 class="popular-searches__title heading--l">Popular Searches</h3>
            <ul class="popular-searches__list">
              {% for search_term in popular_searches_array %}
                {% unless search_term == blank %}
                  <li class="popular-searches__item">
                    <a
                      href="{{ routes.search_url }}?q={{ search_term | url_param_escape }}&type=product&options[prefix]=last"
                      class="popular-searches__link body"
                    >
                      {{ search_term }}
                    </a>
                  </li>
                {% endunless %}
              {% endfor %}
            </ul>
          </div>
        {% endif %}
      </div>

      <div
        id="subDrawerTrigger"
        class="sub-drawer-trigger body--uppercase search-state-transition"
      >
        Knowledge Base
      </div>

      <div
        id="newArrivals"
        class="search-drawer__new-arrivals search-state-transition"
      >
        <h3 class="predictive-search__title heading--l">New Arrivals</h3>
        <div class="search-drawer__new-arrivals-grid">
          {% for product in collections['new-arrivals'].products limit: 6 %}
            <a href="{{ product.url }}" class="search-drawer__product-card">
              <div class="search-drawer__product-image-wrapper">
                {% if product.featured_image != blank %}
                  {% assign image_aspect_ratio = product.featured_image.aspect_ratio | default: 1 %}
                  {% assign image_height = 300 | divided_by: image_aspect_ratio | round %}
                  {{
                    product.featured_image
                    | image_url: width: product.featured_image.width
                    | image_tag:
                      class: 'search-drawer__product-image',
                      sizes: '(max-width: 768px) 150px, 300px',
                      loading: 'lazy',
                      decoding: 'async',
                      alt: product.featured_image.alt
                    | escape
                    | default: product.title, width: 300, height: image_height
                  }}
                {% else %}
                  {{ 'product-1' | placeholder_svg_tag: 'search-drawer__product-image placeholder' }}
                {% endif %}
              </div>

              <h3 class="body--bold search-drawer__product-title">{{ product.title }}</h3>

              <p class="small search-drawer__product-price">
                <span class="search-drawer__product-price--current">{{ product.price | money_with_currency }}</span>
                {% if product.compare_at_price > product.price %}
                  <span class="search-drawer__product-price--compare">
                    Was
                    {{ product.compare_at_price | money_with_currency -}}
                  </span>
                {% endif %}
              </p>
            </a>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>

  <div id="subDrawer" class="sub-drawer custom-scrollbar">
    <header class="sub-drawer__header">
      <button id="subDrawerBack" class="sub-drawer__back" aria-label="Back to search">
        <span>
          {%- render '_icon-arrow-see-less' -%}
        </span>
        <span class="body--uppercase">Back</span>
      </button>
      <h2 class="sub-drawer__title heading--xl">Knowledge Base</h2>
    </header>
    <div class="sub-drawer__content">
      <div class="faq-list">
        {% if section.settings.faq_1_title != blank %}
          <div class="faq-item">
            <h3 class="faq-item__title body--bold">{{ section.settings.faq_1_title }}</h3>
            <p
              class="faq-item__description body"
              data-full-text="{{ section.settings.faq_1_description | escape }}"
            ></p>
          </div>
        {% endif %}

        {% if section.settings.faq_2_title != blank %}
          <div class="faq-item">
            <h3 class="faq-item__title body--bold">{{ section.settings.faq_2_title }}</h3>
            <p
              class="faq-item__description body"
              data-full-text="{{ section.settings.faq_2_description | escape }}"
            ></p>
          </div>
        {% endif %}

        {% if section.settings.faq_3_title != blank %}
          <div class="faq-item">
            <h3 class="faq-item__title body--bold">{{ section.settings.faq_3_title }}</h3>
            <p
              class="faq-item__description body"
              data-full-text="{{ section.settings.faq_3_description | escape }}"
            ></p>
          </div>
        {% endif %}

        {% if section.settings.faq_4_title != blank %}
          <div class="faq-item">
            <h3 class="faq-item__title body--bold">{{ section.settings.faq_4_title }}</h3>
            <p
              class="faq-item__description body"
              data-full-text="{{ section.settings.faq_4_description | escape }}"
            ></p>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</aside>

<script
  src="{{ 'section-search-drawer.js' | asset_url }}"
  defer
></script>

{% schema %}
{
  "name": "Search drawer",
  "enabled_on": {
    "groups": ["header"]
  },
  "settings": [
    {
      "type": "header",
      "content": "Popular Searches"
    },
    {
      "type": "text",
      "id": "popular_search_1",
      "label": "Popular search 1"
    },
    {
      "type": "text",
      "id": "popular_search_2",
      "label": "Popular search 2"
    },
    {
      "type": "text",
      "id": "popular_search_3",
      "label": "Popular search 3"
    },
    {
      "type": "text",
      "id": "popular_search_4",
      "label": "Popular search 4"
    },
    {
      "type": "header",
      "content": "FAQ Settings"
    },
    {
      "type": "text",
      "id": "faq_1_title",
      "label": "FAQ 1 - Title"
    },
    {
      "type": "textarea",
      "id": "faq_1_description",
      "label": "FAQ 1 - Description"
    },
    {
      "type": "url",
      "id": "faq_1_link",
      "label": "FAQ 1 - Link"
    },
    {
      "type": "text",
      "id": "faq_2_title",
      "label": "FAQ 2 - Title"
    },
    {
      "type": "textarea",
      "id": "faq_2_description",
      "label": "FAQ 2 - Description"
    },
    {
      "type": "url",
      "id": "faq_2_link",
      "label": "FAQ 2 - Link"
    },
    {
      "type": "text",
      "id": "faq_3_title",
      "label": "FAQ 3 - Title"
    },
    {
      "type": "textarea",
      "id": "faq_3_description",
      "label": "FAQ 3 - Description"
    },
    {
      "type": "url",
      "id": "faq_3_link",
      "label": "FAQ 3 - Link"
    },
    {
      "type": "text",
      "id": "faq_4_title",
      "label": "FAQ 4 - Title"
    },
    {
      "type": "textarea",
      "id": "faq_4_description",
      "label": "FAQ 4 - Description"
    },
    {
      "type": "url",
      "id": "faq_4_link",
      "label": "FAQ 4 - Link"
    }
  ]
}
{% endschema %}
